"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{"default":t}}function StoreBase(t,s,e){this._storeSubject=new _sf2["default"].BehaviorSubject(t),this._storeState=t,this._storeHistory=[],this._historyIndex=-1,this.action=s,this._subs={},"object"===("undefined"==typeof e?"undefined":_typeof(e))&&Object.assign(this,e)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},_sf=require("./sf.include"),_sf2=_interopRequireDefault(_sf);_sf2["default"].config.useNativeEvents=!0,StoreBase.prototype={constructor:StoreBase,init:function(){this.enableUndoRedo(!0),this.streamChange()},subscribe:function(t,s){return this._storeSubject.subscribe(function(e){t.apply(s,[e])})},dispose:function(t){t?t.dispose():this._storeSubject.dispose()},streamChange:function(){(this.undoRedoSub||this._historyIndex<0)&&(this._historyIndex++,this._storeHistory.push(this._storeState)),this._storeSubject.onNext(this._storeState)},registerAction:function(t,s,e){this._subs[s]||(this._subs[s]=t.subscribe(s,e,this))},unRegisterAction:function(t,s){this._subs[s]&&(t.dispose(this._sub[s]),delete this._subs[s])},bindAction:function(t,s,e){return this.action?this.action.subscribe(t,s,e):void console.warn("StoreBase: missing default action, no call outside of the store.")},unBindAction:function(t){t?this.action.dispose(t):console.warn("StoreBase: missing subscription argument.")},enableUndoRedo:function(t){t?this.undoRedoSub||(this.undoRedoSub=this.bindAction("UNDO_REDO",this.onUndoRedo,this)):this.undoRedoSub&&(this.unBindAction(this.undoRedoSub),this.undoRedoSub=null)},onUndoRedo:function(t){"--"===t.data?this._historyIndex>0&&this._historyIndex--:"++"===t.data&&this._historyIndex<this._storeHistory.length-1&&this._historyIndex++,this._storeState!=this._storeHistory[this._historyIndex]&&(this._storeState=this._storeHistory[this._historyIndex],this._storeSubject.onNext(this._storeState))},resetStoreState:function(t){this._historyIndex=0,this._storeState=t||this._storeHistory[this._historyIndex],this._storeHistory=[this._storeState]}},module.exports=StoreBase;